## Libs
library(data.table)
library(ggplot2); theme_set(theme_bw());
library(foreach)
library(doParallel); registerDoParallel(detectCores()/2)
library(cowplot)
setwd("/Users/juliadomingo/Library/Group Containers/G69SCX94XU.duck/Library/Application Support/duck/Volumes.noindex/intftp.nygenome.org – SFTP/manuscripts/d2n/d2n_ms
")
setwd("/Users/juliadomingo/Library/Group Containers/G69SCX94XU.duck/Library/Application Support/duck/Volumes.noindex/intftp.nygenome.org – SFTP/manuscripts/d2n/d2n_ms")
setwd("/Users/juliadomingo/Library/Group Containers/G69SCX94XU.duck/Library/Application Support/duck/Volumes.noindex/intftp.nygenome.org – SFTP/manuscripts/d2n/d2n_ms/10-complex_traits_and_disease/")
folder_name <- basename(getwd())
data_dir = file.path("../../data", folder_name)
processed_data_dir = file.path("../../processed_data", folder_name)
plots_dir = file.path("../../plots", folder_name)
## Gene annotations
GA.9 <- readRDS("../../processed_data/08-gene_dosage_properties/GA.9_DiseaseGenesOMIM.RDS")
## Gene annotations
GA.9 <- readRDS("../../processed_data/08-gene_dosage_properties/GA.2_DiseaseGenesOMIM.RDS")
rm(GA.9)
GA.1 <- readRDS("../../processed_data/08-gene_dosage_properties/GA.1_GWASgenesUKB.RDS")
# Get model parameters and fitting stats
RMSE_dt <- fread(file = "../../processed_data/07-nonlinear_fit/D2N_AIC_LmSig4Loess.txt")
S4Param_dt <- fread(file = "../../processed_data/07-nonlinear_fit/D2N_S4Param_10fCV.txt")
### (1) Are OMIM genes enriched in non-linear dosage-responses
omim_genes <- GA.9[value == T, gene]
### (1) Are OMIM genes enriched in non-linear dosage-responses
omim_genes <- GA.2[value == T, gene]
### (1) Are OMIM genes enriched in non-linear dosage-responses
omim_genes <- GA.2[value == T, gene]
RMSE_S4P_dt <- merge.data.table(RMSE_dt[, .(dosage_gene, gene, loess_rmse, lm_rmse, delta_RMSE, delta_AIC, delta_RMSE_sig_loess)],
S4Param_dt,
by=c("gene", "dosage_gene"))
RMSE_S4P_dt[, omim_gene := ifelse(gene %in% omim_genes, T, F)]
RMSE_S4P_dt[, non_linear := ifelse(delta_AIC >= 0, T, F)]
### (1) Are OMIM genes enriched in non-linear dosage-responses
omim_genes <- GA.2[value == T, gene]
GA.2 <- readRDS("../../processed_data/08-gene_dosage_properties/GA.2_DiseaseGenesOMIM.RDS")
# Get model parameters and fitting stats
RMSE_dt <- fread(file = "../../processed_data/07-nonlinear_fit/D2N_AIC_LmSig4Loess.txt")
S4Param_dt <- fread(file = "../../processed_data/07-nonlinear_fit/D2N_S4Param_10fCV.txt")
### (1) Are OMIM genes enriched in non-linear dosage-responses
omim_genes <- GA.2[value == T, gene]
RMSE_S4P_dt <- merge.data.table(RMSE_dt[, .(dosage_gene, gene, loess_rmse, lm_rmse, delta_RMSE, delta_AIC, delta_RMSE_sig_loess)],
S4Param_dt,
by=c("gene", "dosage_gene"))
RMSE_S4P_dt[, omim_gene := ifelse(gene %in% omim_genes, T, F)]
RMSE_S4P_dt[, non_linear := ifelse(delta_AIC >= 0, T, F)]
Odds_plot_dt <- foreach(dg = c("GFI1B", "NFE2", "MYB"), .combine = rbind) %do% {
test = fisher.test(table(RMSE_S4P_dt[dosage_gene == dg & unresponsive == F, .(omim_gene, non_linear)]))
data.table(odds = log2(test$estimate),
ci_down = log2(test$conf.int[1]),
ci_up = log2(test$conf.int[2]),
pval = test$p.value,
signif = ifelse(test$p.value < 0.05, T, F),
dosage_gene = dg)
}
ggplot(Odds_plot_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("log2(Odds)") + ylab("") +
ggtitle("OMIM genes having non-linear dosage responses")
### (2) Are GWAS genes enriched in non-linear dosage-responses
gwas_genes <- GA.1[value == T, gene]
RMSE_S4P_dt[, gwas_gene := ifelse(gene %in% gwas_genes, T, F)]
GA.1
RMSE_S4P_dt
Odds_plot_dt <- foreach(dg = c("GFI1B", "NFE2", "MYB"), .combine = rbind) %do% {
test = fisher.test(table(RMSE_S4P_dt[dosage_gene == dg & unresponsive == F, .(gwas_gene, non_linear)]))
data.table(odds = log2(test$estimate),
ci_down = log2(test$conf.int[1]),
ci_up = log2(test$conf.int[2]),
pval = test$p.value,
signif = ifelse(test$p.value < 0.05, T, F),
dosage_gene = dg)
}
ggplot(Odds_plot_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("log2(Odds)") + ylab("") +
ggtitle("OMIM genes having non-linear dosage responses")
GA.1[Platelets == T & gwas_gene == T, gene]
GA.1
GA.1[gene_set == "Platelets(UKB GWAS)" & gwas_gene == T, gene]
GA.1[gene_set == "Platelets(UKB GWAS)" & value == T, gene]
GA.1[gene_set == "RBCs(UKB GWAS)" & gwas_gene == T, gene]
RMSE_S4P_dt[, Platelets := gene %in% GA.1[gene_set == "Platelets(UKB GWAS)" & value == T, gene]]
RMSE_S4P_dt[, RBCs := gene %in% GA.1[gene_set == "RBCs(UKB GWAS)" & value == T, gene]]
RMSE_S4P_dt[, WBCs := gene %in% GA.1[gene_set == "WBCs(UKB GWAS)" & value == T, gene]]
RMSE_S4P_dt[, Reticulocytes := gene %in% GA.1[gene_set == "Reticulocytes(UKB GWAS)" & value == T, gene]]
RMSE_S4P_dt
gwas_traits_v <- c("Platelets",  "RBCs",  "WBCs", "Reticulocytes")
RMSE_S4P_GWASmelt_dt <- melt.data.table(RMSE_S4P_dt[, .SD , .SDcols = c("delta_AIC", "dosage_gene", "unresponsive", "gene", "non_linear", gwas_traits_v)],
id.vars = c("delta_AIC", "dosage_gene", "unresponsive", "gene", "non_linear"),
variable.name = "GWAS_trait", value.name = "GAWAS_gene")
RMSE_S4P_GWASmelt_dt
Odds_plot_GWAS_dt <- foreach(dg = c("GFI1B", "NFE2", "MYB"), .combine = rbind) %do% {
foreach(gt = gwas_traits_v, .combine = rbind) %do% {
test = fisher.test(table(RMSE_S4P_GWASmelt_dt[dosage_gene == dg & unresponsive == F & GWAS_trait == gt, .(GAWAS_gene, non_linear)]))
data.table(odds = log2(test$estimate),
ci_down = log2(test$conf.int[1]),
ci_up = log2(test$conf.int[2]),
pval = test$p.value,
signif = ifelse(test$p.value < 0.05, T, F),
dosage_gene = dg,
GWAS_trait = gt)
}
}
Odds_plot_GWAS_dt
ggplot(Odds_plot_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("log2(Odds)") + ylab("") +
ggtitle("GWAS genes enrichment for non-linear dosage responses") +
facet_grid(GWAS_trait ~ .)
ggplot(Odds_plot_GWAS_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("log2(Odds)") + ylab("") +
ggtitle("GWAS genes enrichment for non-linear dosage responses") +
facet_grid(GWAS_trait ~ .)
Odds_plot_dt <- foreach(dg = c("GFI1B", "NFE2", "MYB"), .combine = rbind) %do% {
test = fisher.test(table(RMSE_S4P_dt[dosage_gene == dg & unresponsive == F, .(omim_gene, non_linear)]))
data.table(odds = log2(test$estimate),
ci_down = log2(test$conf.int[1]),
ci_up = log2(test$conf.int[2]),
pval = test$p.value,
signif = ifelse(test$p.value < 0.05, T, F),
dosage_gene = dg)
}
ggplot(Odds_plot_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("log2(Odds)") + ylab("") +
ggtitle("OMIM genes having non-linear dosage responses")
ggplot(Odds_plot_GWAS_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("log2(Odds)") + ylab("") +
ggtitle("GWAS genes enrichment for non-linear dosage responses") +
facet_grid(GWAS_trait ~ .)
ggplot(Odds_plot_GWAS_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("log2(Odds)") + ylab("") +
ggtitle("GWAS genes") +
theme(axis.title = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank(), axis.line = element_blank()) +
theme(legend.key = element_blank(), strip.background = element_rect(colour="white", fill="white")) +
facet_grid(GWAS_trait ~ .)
ggplot(Odds_plot_GWAS_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("log2(Odds)") + ylab("") +
ggtitle("GWAS genes") +
theme(legend.key = element_blank(), strip.background = element_rect(colour="white", fill="white")) +
facet_grid(GWAS_trait ~ .)
ggplot(Odds_plot_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("log2(Odds)") + ylab("Trans network") +
ggtitle("OMIM genes") +
theme(legend.key = element_blank(), strip.background = element_rect(colour="white", fill="white")) +
### (2) Are GWAS genes enriched in non-linear dosage-responses
gwas_genes <- GA.1[value == T, gene]
ggplot(Odds_plot_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("log2(Odds)") + ylab("Trans network") +
ggtitle("OMIM genes") +
theme(legend.key = element_blank(), strip.background = element_rect(colour="white", fill="white"))
ggplot(Odds_plot_GWAS_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("log2(Odds) for non-linearities") + ylab("Trans network") +
ggtitle("GWAS genes") +
theme(legend.key = element_blank(), strip.background = element_rect(colour="white", fill="white")) +
facet_grid(GWAS_trait ~ .)
pB <- ggplot(Odds_plot_GWAS_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("log2(Odds) for non-linearities") + ylab("Trans network") +
ggtitle("GWAS genes") +
theme(legend.key = element_blank(), strip.background = element_rect(colour="white", fill="white")) +
facet_grid(GWAS_trait ~ .)
p <- cowplot::plot_grid(pA, pB, align = "v", axis = "lr", nrow = 2, rel_heights = c(1/5, 5/5))
pB <- ggplot(Odds_plot_GWAS_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("log2(Odds) for non-linearities") + ylab("Trans network") +
ggtitle("GWAS genes") +
theme(legend.key = element_blank(), strip.background = element_rect(colour="white", fill="white")) +
facet_grid(GWAS_trait ~ .)
pA <- ggplot(Odds_plot_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("") + ylab("Trans network") +
ggtitle("OMIM genes") +
theme(legend.key = element_blank(), strip.background = element_rect(colour="white", fill="white"))
p <- cowplot::plot_grid(pA, pB, align = "v", axis = "lr", nrow = 2, rel_heights = c(1/5, 5/5))
p
p <- cowplot::plot_grid(pA, pB, align = "v", axis = "lr", nrow = 2, rel_heights = c(2/5, 3/5))
p
p <- cowplot::plot_grid(pA, pB, align = "v", axis = "lr", nrow = 2, rel_heights = c(1/4, 3/4))
p
pA <- ggplot(Odds_plot_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("") + ylab("") +
ggtitle("OMIM genes") +
theme(legend.key = element_blank(), strip.background = element_rect(colour="white", fill="white"))
pB <- ggplot(Odds_plot_GWAS_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("log2(Odds) for non-linearities") + ylab("Trans network") +
ggtitle("GWAS genes") +
theme(legend.key = element_blank(), strip.background = element_rect(colour="white", fill="white")) +
facet_grid(GWAS_trait ~ .)
p <- cowplot::plot_grid(pA, pB, align = "v", axis = "lr", nrow = 2, rel_heights = c(1/4, 3/4))
p
ggsave(file.path(plots_dir, "10a_OMIM_GWAS_Nonlinear_Odds.pdf"), width = 4 , height = 8)
ggsave(file.path(plots_dir, "10a_OMIM_GWAS_Nonlinear_Odds.pdf"), width = 3 , height = 6)
ggsave(file.path(plots_dir, "10a_OMIM_GWAS_Nonlinear_Odds.pdf"), width = 2.5 , height = 5)
pA <- ggplot(Odds_plot_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("") + ylab("Trans network") +
ggtitle("OMIM genes") +
theme(legend.key = element_blank(), strip.background = element_rect(colour="white", fill="white"))
p <- cowplot::plot_grid(pA, pB, align = "v", axis = "lr", nrow = 2, rel_heights = c(1/4, 3/4))
p
ggsave(file.path(plots_dir, "10a_OMIM_GWAS_Nonlinear_Odds.pdf"), width = 2.5 , height = 5)
pA <- ggplot(Odds_plot_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
ylab("Trans network") +
theme(axis.title.x = element_blank()) +
ggtitle("OMIM genes") +
theme(legend.key = element_blank(), strip.background = element_rect(colour="white", fill="white"))
pB <- ggplot(Odds_plot_GWAS_dt, aes(x=odds, y=dosage_gene, color = signif)) +
geom_vline(xintercept = 0, linetype = 2, color = "grey50") +
geom_point(size = 3, show.legend = F) +
geom_errorbarh(aes(xmin = ci_down, xmax = ci_up), height = 0.2, show.legend = F) +
scale_color_manual("OMIM gene?", values = c(`TRUE` = "#56B1F7", `FALSE`= "black")) +
xlab("log2(Odds) for non-linearities") + ylab("Trans network") +
ggtitle("GWAS genes") +
theme(legend.key = element_blank(), strip.background = element_rect(colour="white", fill="white")) +
facet_grid(GWAS_trait ~ .)
p <- cowplot::plot_grid(pA, pB, align = "v", axis = "lr", nrow = 2, rel_heights = c(1/4, 3/4))
p
ggsave(file.path(plots_dir, "10a_OMIM_GWAS_Nonlinear_Odds.pdf"), width = 2.5 , height = 5)
union_genes <- omim_genes[omim_genes %in% gwas_genes]
dt_unresp <- S4Param_dt[, sum(unresponsive), gene]
plot_genes <- dt_unresp[gene %in% union_genes & V1 < 2, gene]
p <- ggplot(DE_dt[gene %in% plot_genes & dosage_gene != "TET2", ], aes(x = dosage_gene_log2FC, y=avg_log2FC)) +
facet_grid(gene ~ dosage_gene, scales = "free") +
geom_point(color = "grey20", alpha=0.7) +
geom_line(data = Fit_curves_dt[gene %in% plot_genes & dosage_gene != "TET2", ], color="#FF7F00", linewidth = 0.75) +
theme(legend.key = element_blank(), strip.background = element_rect(colour="white", fill="white")) +
labs(x="Cis gene log2(FC)", y="Trans gene log2(FC)")
Fit_curves_dt <- fread("../../processed_data/07-nonlinear_fit/D2N_S4LoessModelFits.txt")
Fit_curves_dt
DE_dt <- readRDS("../../../../projects/004-dosage_network/009-DEanalyses/processed_data/after_seurat4.3/d2n_DemuxHTOdCas9_Wilcoxon_AllGenesDE.RDS")
Fit_curves_dt <- fread("../../processed_data/07-nonlinear_fit/D2N_S4LoessModelFits.txt")
union_genes <- omim_genes[omim_genes %in% gwas_genes]
dt_unresp <- S4Param_dt[, sum(unresponsive), gene]
plot_genes <- dt_unresp[gene %in% union_genes & V1 < 2, gene]
p <- ggplot(DE_dt[gene %in% plot_genes & dosage_gene != "TET2", ], aes(x = dosage_gene_log2FC, y=avg_log2FC)) +
facet_grid(gene ~ dosage_gene, scales = "free") +
geom_point(color = "grey20", alpha=0.7) +
geom_line(data = Fit_curves_dt[gene %in% plot_genes & dosage_gene != "TET2", ], color="#FF7F00", linewidth = 0.75) +
theme(legend.key = element_blank(), strip.background = element_rect(colour="white", fill="white")) +
labs(x="Cis gene log2(FC)", y="Trans gene log2(FC)")
p
p <- ggplot(DE_dt[gene %in% plot_genes & dosage_gene != "TET2" & dosage_gene != "NTC", ], aes(x = dosage_gene_log2FC, y=avg_log2FC)) +
facet_grid(gene ~ dosage_gene, scales = "free") +
geom_point(color = "grey20", alpha=0.7) +
geom_line(data = Fit_curves_dt[gene %in% plot_genes & dosage_gene != "TET2", ], color="#FF7F00", linewidth = 0.75) +
theme(legend.key = element_blank(), strip.background = element_rect(colour="white", fill="white")) +
labs(x="Cis gene log2(FC)", y="Trans gene log2(FC)")
p
